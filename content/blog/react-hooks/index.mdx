---
title: useMemo (memo), useCallbackã®ä½¿ã„æ–¹
date: '2021-08-28T12:46:37.121Z'
description: useMemo, useCallbackã¯ãŸã¾ã«ä½¿ã†ã‘ã©ã€ã„ã¾ã„ã¡ä½¿ã„ã©ããŒã‚ã‹ã‚‰ãªã„ã“ã¨ã¯ãªã„ã§ã—ã‚‡ã†ã‹ï¼Ÿç°¡å˜ãªã‚µãƒ³ãƒ—ãƒ«ã‚’äº¤ãˆã¦æŒ™å‹•ã¨ã€ä½¿ã„æ–¹ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚
tags: ['react', 'hooks']
categories: ['Programming']
thumbnail: './top.png'
---

ã“ã‚“ã«ã¡ã¯ã€Wataruã§ã™ã€‚

useMemo, useCallbackã¯ãŸã¾ã«ä½¿ã†ã‘ã©ã€ã„ã¾ã„ã¡ä½¿ã„ã©ããŒã‚ã‹ã‚‰ãªã„ã“ã¨ã¯ãªã„ã§ã—ã‚‡ã†ã‹ï¼Ÿã‚ã€ãƒ¬ãƒ³ãƒ€ãƒ¼ã¡ã‚‡ã£ã¨é…ã„ãªã¨ã‹ã€ãƒ“ãƒ¥ãƒ¼ãŒãƒã‚«ãƒã‚«ã™ã‚‹ãªã¨ã‹ã€ãã†ã„ã£ãŸç›®ã«è¦‹ãˆã¦ä¸å…·åˆã‚ã‚‹æ™‚ã®ã¿ã«ä½¿ã£ã¦ã„ã¾ã—ãŒã€ç†è§£ãŒæ›–æ˜§ãªã¾ã¾ä½¿ã£ã¦ä½¿ã£ã¦ã„ã¾ã—ãŸã€‚

ä»Šå›ã¯ã€useCallback, useMemo (memo)ã®ä½¿ã„æ–¹ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šã®ãŸã‚ã«ç”¨ã„ã‚‰ã‚Œã‚‹hooksã§ã™ã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆèª­ã‚“ã ã‚Šã€è¨˜äº‹è¦‹ãŸã‚Šã—ãŸã®ã§ã™ãŒã€ã„ã¾ã„ã¡è…‘ã«è½ã¡ãªã„ãªã¨æ€ã†ã“ã¨ãŒå¤šã‹ã£ãŸã®ã§ã€ç†è§£ã™ã‚‹ã«ã‚ãŸã‚Šã€ç°¡å˜ãªã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚¢ãƒ—ãƒªã‚’ä½¿ã„æŒ™å‹•ã®ç¢ºèªã—ãŸã®ã§ã€ãã®çµæœã¨ä½µã›ã¦ç´¹ä»‹ã—ã¾ã™ã€‚ãã‚Œã§ã¯ã¿ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

## ãªãœå¿…è¦?

Reactã¯ã€stateã®å¤‰æ›´ã™ã‚‹ã¨ã€ãƒ“ãƒ¥ãƒ¼ã‚’å†æå†™ã—ã¦ãã‚Œã‚‹ã®ä¾¿åˆ©ãªãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚ä¾¿åˆ©ãªåé¢ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚‚è€ƒãˆã¦å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä¾‹ãˆã°ã€å¤šãã®å…¥åŠ›é …ç›®ãŒã‚ã‚‹ç”»é¢ãŒã‚ã£ãŸã¨ã—ã¾ã—ã‚‡ã†ã€‚ã‚ã‚‹é …ç›®ã«ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã™ã‚‹ã¨ã€å…¥åŠ›å†…å®¹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¾ã™ã€‚stateãŒæ›´æ–°ã•ã‚Œã€stateã®å¤‰æ›´ã«ã‚ˆã£ã¦ã€ç”»é¢å†…ã®å…¨ã¦ã®ãƒ“ãƒ¥ãƒ¼ãŒå†æå†™ã•ã‚Œã¾ã™ã€‚ã“ã®å ´åˆã€å¤‰æ›´ã™ã¹ãã¯å…¥åŠ›ã®ã‚ã£ãŸé …ç›®ã ã‘ã§ã€ãã®ä»–å¤‰æ›´ã®ãªã„ãƒ“ãƒ¥ãƒ¼ã®å†æå†™ã¯å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚

ãƒ“ãƒ¥ãƒ¼ã®å†æå†™ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã¯ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã®ã‚ã‚‰ã‚†ã‚‹é–¢æ•°ã¯ç ´æ£„ã•ã‚Œã€å†åº¦ãƒ¡ãƒ¢ãƒªãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¾ã™ã€‚å†æå†™ã®éš›ã€æ›´æ–°ãŒå¿…è¦ã§ãªã„ã‚‚ã®ã¯ã€ã“ã®ãƒ¡ãƒ¢ãƒªã®ç ´æ£„->å†åº¦å‰²ã‚Šå½“ã¦ãŒã€å¿…è¦ãªã„ã®ã§ã€useCallback, userMemoã‚’ä½¿ã„ã€ä½™åˆ†ãªå†æå†™ã—ãªã„ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã¨ã„ã†ã“ã¨ã§ã™(=ãƒ¡ãƒ¢åŒ–)ã€‚

ä»Šå›ã¯ã‚ã‹ã‚Šã‚„ã™ãã™ã‚‹ãŸã‚ã€ç°¡å˜ãªã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚¢ãƒ—ãƒªã‚’ä½¿ã£ã¦ã„ã¾ã™ãŒã€å°ã•ã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€é–¢æ•°å˜ä½ã§ã€useCallback, useMemoã®å¿…è¦æ€§ã¯ã‚ã¾ã‚Šã‚ã‚Šã¾ã›ã‚“ã€‚ä»Šå›ã®è¨˜äº‹ã¯ã‚ãã¾ã§hooksã®æŒ™å‹•ã‚’ç†è§£ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã¨è€ƒãˆã¦ãŠã„ã¦ãã ã•ã„ã€‚

## useCallback, useMemo(memo)ã®ä½¿ã„åˆ†ã‘

å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®[Hook API Reference](https://ja.reactjs.org/docs/hooks-reference.html)ã«ã‚ã‚‹é€šã‚Šã€

- useCallback ãƒ»ãƒ»ãƒ»ã€€ãƒ¡ãƒ¢åŒ–ã•ã‚ŒãŸ **é–¢æ•°** ã‚’è¿”ã—ã¾ã™ã€‚
- useMemoã€€ãƒ»ãƒ»ãƒ» ãƒ¡ãƒ¢åŒ–ã•ã‚ŒãŸ **å€¤** ã‚’è¿”ã—ã¾ã™ã€‚

å°‘ã—ã‚ã‹ã‚Šã¥ã‚‰ã„ã§ã™ãŒã€useCallbackã¯"é–¢æ•°"è‡ªä½“ã‚’ãƒ¡ãƒ¢åŒ–ã€‚useMemoã¯ã€"çµæœ"ã‚’ãƒ¡ãƒ¢åŒ–ã—ã¾ã™ã€‚

- memo ãƒ»ãƒ»ãƒ»ã€€useMemoã¨åŒã˜ã€‚HOC(â€»1)ã¨ã—ã¦ä½¿ã†ã€‚

ã¡ã‚‡ã£ã¨ä½•è¨€ã£ã¦ã‚‹ã‹ã‚ã‹ã‚‰ãªã„ã€‚ã€‚ã€‚ã¨æ€ã†ã®ã§ã€ä»¥ä¸‹ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚¢ãƒ—ãƒªã‚’ã¿ã¦ã€æŒ™å‹•ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚

(â€»1) ãƒã‚¤ã‚ªãƒ¼ãƒ€ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€‚ ä»–ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã“ã¨

## ä»Šå›ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰

ãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ã™ã‚‹ã¨ã€ãƒ©ãƒ™ãƒ«ã®æ•°å­—ãŒ1ãšã¤åŠ ç®—ã•ã‚Œã‚‹ç°¡å˜ãªã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚¢ãƒ—ãƒªã§ã™ã€‚æ‰‹å…ƒã§å®Ÿé¨“ã—ãŸã„æ–¹ã¯ã€[ã“ã¡ã‚‰](https://github.com/WataruMaeda/try-hooks)ã‹ã‚‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã€å®Ÿé¨“ã—ã¦ãã ã•ã„ã€‚

![counter-app](./1.gif "counter-app")

ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’é–‹ãã¨ã€ä»¥ä¸‹ã®ãƒ­ã‚°ãŒstateå¤‰æ›´ã”ã¨ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚
- ğŸš€ [Title Label] render
- ğŸ˜² [Counter Label] render
- âœ… [Button] render

ã“ã‚Œã¯ã‚«ã‚¦ãƒ³ãƒˆã‚’Stateã§ç®¡ç†ã—ã¦ã„ã‚‹ãŸã‚ã€ã‚«ã‚¦ãƒ³ãƒˆæ›´æ–°ã”ã¨ã«ãƒ“ãƒ¥ãƒ¼ã®å†æèµ·ãã€ãã‚Œã«ä½µã›ã¦ãƒ©ãƒ™ãƒ«ã€ãƒœã‚¿ãƒ³å†æå†™ã‚‚è¡Œã‚ã‚Œã¦ã„ã¾ã™ã€‚ãƒ­ã‚°ã¯å†æå†™ãŒè¡Œã‚ã‚ŒãŸã‹ã©ã†ã‹ã®ç¢ºèªã®ãŸã‚ã§ã™ã€‚

æœ¬æ¥ã§ã‚ã‚Œã°ã€ã‚¿ã‚¤ãƒˆãƒ«ã¨ã€ãƒœã‚¿ãƒ³ã®å†æå†™ã¯å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚ãªãœãªã‚‰å†æå†™å‰ã¨æ¯”ã¹å¤‰æ›´ãŒå¿…è¦ãªã„ã‹ã‚‰ã§ã™ã€‚ãã‚Œã§ã¯hooksã‚’ä½¿ã£ã¦ä¸å¿…è¦ãªå†æå†™ãŒèµ·ããªã„ã‚ˆã†ãƒ¡ãƒ¢åŒ–ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

â†“å…ƒã®ã‚³ãƒ¼ãƒ‰

```javascript {numberLines}
import React, { useState } from 'react'

function TitleLabel(props) {
  console.log('ğŸš€ [Title Label] render')
  return (
    <span {...props} />
  ) 
}

function CounterLabel(props) {
  console.log('ğŸ˜² [Counter Label] render')
  return (
    <span {...props} />
  ) 
}

function Button(props) {
  console.log('âœ… [Button] render')
  return (
    <button type="button" {...props} />
  )
}

function App() {
  const [count, setCount] = useState(0)
  const countUp = () => setCount(pre => pre + 1)
  return (
    <div>
      <TitleLabel>Counter</TitleLabel>
      <CounterLabel>{count}</CounterLabel>
      <Button onClick={countUp}>
        Count Up
      </Button>
    </div>
  );
}

export default App;
```

## memoã‚’ä½¿ã£ã¦ãƒ¡ãƒ¢åŒ–ã™ã‚‹

memoã¯HOCã§ã‚ã‚‹ãŸã‚ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹ã“ã¨ã§ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚ã§ã™ã®ã§ã€ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã®Label, Buttonã‚’ãƒ¡ãƒ¢åŒ–ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚


```javascript {numberLines}
// import React, { useState } from 'react'
// highlight-start
import React, { useState, memo } from 'react'
// highlight-end

// highlight-start
const TitleLabel = memo(function (props) {
  console.log('ğŸš€ [Title Label] render')
  return (
    <span {...props} />
  ) 
})
// highlight-end
// function TitleLabel(props) {
//   console.log('ğŸš€ [Title Label] render')
//   return (
//     <span {...props} />
//   ) 
// }

// highlight-start
const CounterLabel = memo(function (props) {
  console.log('ğŸ˜² [Counter Label] render')
  return (
    <span {...props} />
  ) 
})
// highlight-end
// function CounterLabel(props) {
//   console.log('ğŸ˜² [Counter Label] render')
//   return (
//     <span {...props} />
//   ) 
// }

// highlight-start
const Button = memo(function(props) {
  console.log('âœ… [Button] render')
  return (
    <button type="button" {...props} />
  )
})
// highlight-end
// function Button(props) {
//   console.log('âœ… [Button] render')
//   return (
//     <button type="button" {...props} />
//   )
// }
```

çµæœ...

![counter-app](./2.gif "counter-app")

- ğŸš€ [Title Label] render

ã®ãƒ­ã‚°ãŒãªããªã‚Šã¾ã—ãŸã­ã€‚ã“ã‚Œã¯å‰å›ã®æå†™ã¨æ¯”ã¹ã¦å¤‰æ›´ãŒãªã‹ã£ãŸã®ã§ã€å†æå†™ã®å¿…è¦ãŒãªã‹ã£ãŸã¨è¨€ã†ã“ã¨ã§ã™ã€‚ä¸€æ–¹ã€

- ğŸ˜² [Counter Label] render

ã¯å¤‰ã‚ã‚‰ãšå†æå†™ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã¡ã‚‰ã¯ã€stateã§ç®¡ç†ã—ã¦ã„ã‚‹countãŒæ›´æ–°ã•ã‚ŒãŸãŸã‚ã€ãƒ“ãƒ¥ãƒ¼ã®å†æå†™ãŒå¿…è¦ã«ãªã£ãŸãŸã‚ã§ã™ã€‚

- âœ… [Button] render

ã“ã¡ã‚‰ã¯å†æå†™ã•ã‚Œã¦ã„ã¾ã™ã­ã€‚ã‚ã‚Œã€‚ã€‚ã¨æ€ã£ãŸæ–¹ã¯æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§è§£èª¬ã—ã¾ã™ã€‚

## ãªãœãƒœã‚¿ãƒ³ã®ãƒ¡ãƒ¢åŒ–ãŒè¡Œã‚ã‚Œã¦ã„ãªã„ã®ã‹

çµè«–ã‹ã‚‰è¨€ã†ã¨ã€Buttonã«æ¸¡ã—ã¦ã„ã‚‹é–¢æ•°ãŒã€å†æå†™å‰ã¨æ¯”ã¹å¤‰æ›´ãŒã‚ã£ãŸã¨Reactå´ãŒåˆ¤æ–­ã—ã¦ã„ã‚‹ã‹ã‚‰ã§ã™ã€‚

é–¢æ•°ã€Array, object ã¯ ã‚¤ã‚³ãƒ¼ãƒ«(===)ã¨ã—ã¦åˆ¤æ–­ã•ã‚Œã¾ã›ã‚“ã€‚

```javascript {numberLines}
true === true // true
false === false // true
1 === 1 // true
'a' === 'a' // true

{} === {} // false
[] === [] // false
() => {} === () => {} // false

const z = {}
z === z // true
```

ã“ã“ã‹ã‚‰ã‚ã‹ã‚‹ã“ã¨ã¯ã€å†æå†™ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã€é–¢æ•°ã‚‚ç ´æ£„->å†ç”Ÿæˆã‚‰ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

```javascript
const countUp = () => setCount(pre => pre + 1)
```

ã“ã“ã§useCallbackã®å‡ºç•ªã§ã™ã€‚ã“ã®é–¢æ•°ã‚’ãƒ¡ãƒ¢åŒ–ã—ã¾ã—ã‚‡ã†ã€‚

```javascript
// const countUp = () => setCount(pre => pre + 1)
// highlight-start
const countUp = useCallback(() => setCount(pre => pre + 1), [])
// highlight-end
```

çµæœ...

![counter-app](./3.gif "counter-app")

- ğŸ˜² [Counter Label] render

ã®ã¿ã®è¡¨ç¤ºã«ãªã‚Šã¾ã—ãŸã­ã€‚

ä»¥ä¸Šã«ãªã‚Šã¾ã™ã€‚æœ€å¾Œã¾ã§èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚